{{template "admin" .}}

{{define "content"}}
<!-- Category Groups Section -->
<div class="mb-8">
    <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-bold">Category Groups</h2>
        <button id="add-group" class="bg-purple-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-purple-700">
            + Add Group
        </button>
    </div>
    <div class="bg-white rounded-lg shadow p-4 mb-2">
        <p class="text-sm text-gray-600 mb-2">
            Groups organize categories and can enforce mutual exclusivity (voters can only vote for the same car once per exclusivity pool).
        </p>
    </div>
    <div id="groups-list" class="space-y-4">
        <!-- Groups will be inserted here -->
    </div>
</div>

<!-- Categories Section -->
<div class="flex justify-between items-center mb-6">
    <h2 class="text-2xl font-bold">Award Categories</h2>
    <div class="flex space-x-3">
        <button id="sync-derbynet" class="bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-blue-700">
            Sync with DerbyNet
        </button>
        <button id="add-category" class="bg-green-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-green-700">
            + Add Category
        </button>
    </div>
</div>

<!-- Sync Status Message -->
<div id="sync-status" class="hidden fixed top-4 right-4 bg-white rounded-lg shadow-lg p-4 z-50 max-w-sm">
    <p id="sync-message" class="text-sm"></p>
</div>

<div id="categories-list" class="space-y-4">
    <!-- Categories will be inserted here -->
</div>

<!-- Add/Edit Modal -->
<div id="category-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
        <h3 id="modal-title" class="text-xl font-bold mb-4">Add Category</h3>
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Category Name</label>
                <input type="text" id="category-name"
                       class="w-full border border-gray-300 rounded-lg px-4 py-2"
                       placeholder="e.g., Most Creative">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Display Order</label>
                <input type="number" id="category-order"
                       class="w-full border border-gray-300 rounded-lg px-4 py-2"
                       value="1" min="1">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Category Group</label>
                <select id="category-group"
                        class="w-full border border-gray-300 rounded-lg px-4 py-2">
                    <option value="">None (Independent)</option>
                    <!-- Groups will be populated here -->
                </select>
                <p class="text-xs text-gray-500 mt-1">Optional: Assign to a group for organization and exclusivity</p>
            </div>
            <div>
                <div class="flex items-center justify-between mb-2">
                    <label class="block text-sm font-medium text-gray-700">Allowed Voter Types</label>
                    <button type="button" id="clear-voter-types" class="text-xs text-blue-600 hover:text-blue-800">Clear All (Allow All Voters)</button>
                </div>
                <div id="voter-types-multiselect" class="border border-gray-300 rounded-lg p-3 space-y-2 max-h-48 overflow-y-auto">
                    <!-- Voter type checkboxes will be populated here -->
                </div>
                <p class="text-xs text-gray-500 mt-1">Select specific voter types, or leave all unchecked to allow all voters.</p>
            </div>
            <div>
                <div class="flex items-center justify-between mb-2">
                    <label class="block text-sm font-medium text-gray-700">Allowed Classes</label>
                    <button type="button" id="clear-ranks" class="text-xs text-blue-600 hover:text-blue-800">Clear All (Allow All Classes)</button>
                </div>
                <div id="ranks-multiselect" class="border border-gray-300 rounded-lg p-3 space-y-2 max-h-48 overflow-y-auto">
                    <!-- Class checkboxes will be populated here -->
                </div>
                <p class="text-xs text-gray-500 mt-1">Select specific classes (e.g., Tiger, Lion, Bear), or leave all unchecked to allow all classes.</p>
            </div>
        </div>
        <div class="flex justify-end space-x-4 mt-6">
            <button id="modal-cancel" class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancel</button>
            <button id="modal-save" class="bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-blue-700">Save</button>
        </div>
    </div>
</div>

<!-- Group Add/Edit Modal -->
<div id="group-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
        <h3 id="group-modal-title" class="text-xl font-bold mb-4">Add Category Group</h3>
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Group Name</label>
                <input type="text" id="group-name"
                       class="w-full border border-gray-300 rounded-lg px-4 py-2"
                       placeholder="e.g., Design Awards">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                <textarea id="group-description"
                          class="w-full border border-gray-300 rounded-lg px-4 py-2"
                          rows="2"
                          placeholder="Optional description"></textarea>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Exclusivity Pool</label>
                <select id="group-exclusivity"
                        class="w-full border border-gray-300 rounded-lg px-4 py-2">
                    <option value="">None - Independent voting</option>
                    <option value="auto">Just This Group - Unique pool</option>
                    <option value="1">Pool 1</option>
                    <option value="2">Pool 2</option>
                    <option value="3">Pool 3</option>
                    <option value="4">Pool 4</option>
                    <option value="5">Pool 5</option>
                </select>
                <p class="text-xs text-gray-500 mt-1">Categories in the same pool are mutually exclusive (can't vote for same car in multiple categories)</p>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Max Wins Per Car</label>
                <input type="number" id="group-max-wins"
                       class="w-full border border-gray-300 rounded-lg px-4 py-2"
                       placeholder="Leave blank for unlimited" min="1">
                <p class="text-xs text-gray-500 mt-1">Optional: Limit how many awards from this group a single car can win (e.g., 1 = each car can only win once)</p>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Display Order</label>
                <input type="number" id="group-order"
                       class="w-full border border-gray-300 rounded-lg px-4 py-2"
                       value="1" min="1">
            </div>
        </div>
        <div class="flex justify-end space-x-4 mt-6">
            <button id="group-modal-cancel" class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancel</button>
            <button id="group-modal-save" class="bg-purple-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-purple-700">Save</button>
        </div>
    </div>
</div>
{{end}}

{{define "scripts"}}
<script src="/static/js/utils.js"></script>
<script src="/static/js/categories.js"></script>
{{end}}
